<!-- apresentar as vendas realizadas mes a mes e o valor a receber no mes vigente. -->

<?php
  include_once './config.php';

  $titulo = "Abelha Rainha";

  $home = "nav-link";
  $colaboradoras = "nav-link";
  $clientes = "nav-link";

  include CABECALHO;
?>
<h1>Cosméticos Abelha Rainha</h1>
<hr>

<form class="form-inline" method="POST" action="/abelhaRainha">
  <div class="form-group col-sm-auto">
    <p>Selecione o ano:</p>
  </div>
  <div class="form-group col-sm-auto">
    <select class="form-control" name="ano">
      <?php
        //crio um array para receber os anos de vendas
        $anos = [];
        //crio o objeto $xml com os dados de vendas
        $xml = simplexml_load_file('./views/abelha_rainha/vendasAnuais.xml');
        //percooro o objeto $xml atribuindo ao objeto $lista cada registro de venda
        foreach($xml->registro as $lista):
          //atribuo o ano ao array
          $anos[] = $lista->ano;
        endforeach;
        //inicio um for para apresentar os anos de tras para frente
        for($i = count($anos); $i > 0; $i--){
          echo "<option value='" . $anos[$i-1] . "'>" . $anos[$i-1] . "</option>";
        }
      ?>
    </select>
  </div>
  <button type="submit" class="btn btn-success mb-2">Listar</button>
</form>
<hr>
<div class="row">
  <div class="col-md-6">
    <h2>Valores a Receber - Mês: <?php echo date('M')."/".date('Y'); ?></h2>
    <hr>
    valores a receber:
  </div>
  <div class="col-md-6">
<h2>Vendas realizadas mês a mês</h2>
<table class="table table-sm table-bordered table-hover">
  <thead class="thead-dark">
    <tr align="center">
      <th >Mês</th>
      <th ">Valor</th>
      <th >Situação</th>
      <th >Opção</th>
    </tr>
  </thead>
  <tbody>
    <?php
      if($_SERVER['REQUEST_METHOD'] == 'POST'){
        $ano = $_POST['ano'];
        $xml = simplexml_load_file('./views/abelha_rainha/vendasAnuais.xml');
        foreach($xml->registro as $registro):
          if((int)$registro->ano == $ano){
            foreach($registro->vendas->venda as $venda):
              echo "<tr align='middle'>";
              echo "<td>" . $venda->mes . "/" . $ano . "</td>";
              echo "<td>" . $venda->valor . "</td>";
                if($venda->situacao == "PENDENTE"){
                  echo "<td class='bg-warning text-white'><em><strong>" . $venda->situacao . "</strong></em></td>";
                } else {
                  echo "<td class='bg-success text-white'><em><strong>" . $venda->situacao . "</strong></em></td>";
                }
              echo "<td><buton type='button' class='btn btn-primary btn-sm'>Mais...</buton></td>";
              echo "</tr>";
            endforeach;
          }
        endforeach;
      } else {
        $ano = date('Y');
        $xml = simplexml_load_file('./views/abelha_rainha/vendasAnuais.xml');
        foreach($xml->registro as $registro):
          if((int)$registro->ano == $ano){
    foreach($registro->vendas->venda as $venda):
      echo "<tr align='middle'>";
    echo "<td>" . $venda->mes . "/" . $ano . "</td>";
    echo "<td>" . $venda->valor . "</td>";
    if($venda->situacao == "PENDENTE"){
      echo "<td class='bg-warning text-white'><em><strong>" . $venda->situacao . "</strong></em></td>";
    } else {
      echo "<td class='bg-success text-white'><em><strong>" . $venda->situacao . "</strong></em></td>";
    }
    echo "<td><buton type='button' class='btn btn-primary btn-sm'>Mais...</buton></td>";
      echo "</tr>";
    endforeach;
          }
        endforeach;
      }
    ?>
  </tbody>
</table>
  </div>
 
</div>
<?php include RODAPE; ?>